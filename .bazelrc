try-import %workspace%/.bazelrc.user

build --java_language_version=11
build --tool_java_language_version=11
build --javacopt="-Xep:WildcardImport:ERROR"

common --enable_bzlmod

# To update these lines, execute
# `bazel run @rules_bazel_integration_test//tools:update_deleted_packages`
build --deleted_packages=.bazelbsp,.bazelbsp/aspects,e2e/test-resources/android-kotlin-project/src/main,e2e/test-resources/android-kotlin-project/src/main/java/com/example/myapplication,e2e/test-resources/android-kotlin-project/src/test/java/com/example/myapplication,e2e/test-resources/android-project/src/main,e2e/test-resources/android-project/src/main/java/com/example/myapplication,e2e/test-resources/android-project/src/test/java/com/example/myapplication,e2e/test-resources/cpp-project/example,e2e/test-resources/enabled-rules-project/langs,e2e/test-resources/enabled-rules-project/scala_targets,e2e/test-resources/kotlin-project,e2e/test-resources/kotlin-project/kotlinc_test,e2e/test-resources/local-jdk-project/example,e2e/test-resources/python-project/example,e2e/test-resources/python-project/lib,e2e/test-resources/python-project/test,e2e/test-resources/remote-jdk-project/example,e2e/test-resources/rust-project,e2e/test-resources/rust-project/example,e2e/test-resources/rust-project/example-lib,e2e/test-resources/sample-repo/environment_variables,e2e/test-resources/sample-repo/java_targets,e2e/test-resources/sample-repo/java_targets/subpackage,e2e/test-resources/sample-repo/manual_target,e2e/test-resources/sample-repo/scala_targets,e2e/test-resources/sample-repo/target_with_dependency,e2e/test-resources/sample-repo/target_without_args,e2e/test-resources/sample-repo/target_without_jvm_flags,e2e/test-resources/sample-repo/target_without_main_class,e2e/test-resources/sample-repo/target_with_resources,install/src/main/kotlin/.bazelbsp,install/src/main/kotlin/.bazelbsp/aspects
query --deleted_packages=.bazelbsp,.bazelbsp/aspects,e2e/test-resources/android-kotlin-project/src/main,e2e/test-resources/android-kotlin-project/src/main/java/com/example/myapplication,e2e/test-resources/android-kotlin-project/src/test/java/com/example/myapplication,e2e/test-resources/android-project/src/main,e2e/test-resources/android-project/src/main/java/com/example/myapplication,e2e/test-resources/android-project/src/test/java/com/example/myapplication,e2e/test-resources/cpp-project/example,e2e/test-resources/enabled-rules-project/langs,e2e/test-resources/enabled-rules-project/scala_targets,e2e/test-resources/kotlin-project,e2e/test-resources/kotlin-project/kotlinc_test,e2e/test-resources/local-jdk-project/example,e2e/test-resources/python-project/example,e2e/test-resources/python-project/lib,e2e/test-resources/python-project/test,e2e/test-resources/remote-jdk-project/example,e2e/test-resources/rust-project,e2e/test-resources/rust-project/example,e2e/test-resources/rust-project/example-lib,e2e/test-resources/sample-repo/environment_variables,e2e/test-resources/sample-repo/java_targets,e2e/test-resources/sample-repo/java_targets/subpackage,e2e/test-resources/sample-repo/manual_target,e2e/test-resources/sample-repo/scala_targets,e2e/test-resources/sample-repo/target_with_dependency,e2e/test-resources/sample-repo/target_without_args,e2e/test-resources/sample-repo/target_without_jvm_flags,e2e/test-resources/sample-repo/target_without_main_class,e2e/test-resources/sample-repo/target_with_resources,install/src/main/kotlin/.bazelbsp,install/src/main/kotlin/.bazelbsp/aspects

# From https://docs.aspect.build/guides/bazelrc/
build --incompatible_strict_action_env
startup --host_jvm_args=-DBAZEL_TRACK_SOURCE_DIRECTORIES=1
build --noexperimental_check_output_files
build --noexperimental_check_external_repository_files
build --experimental_reuse_sandbox_directories

# Setup EngFlow's Remote Cache
build:engflow_cache --disk_cache=
build:engflow_cache --remote_timeout=600
build:engflow_cache --config=engflow_auth
build:engflow_cache --remote_cache_compression=true
build:engflow_cache --remote_download_minimal
build:engflow_cache --remote_cache=grpcs://regolith.cluster.engflow.com
build:engflow_cache --bes_backend=grpcs://regolith.cluster.engflow.com
build:engflow_cache --bes_results_url=https://regolith.cluster.engflow.com/invocation/

# Setup EngFlow's Remote Execution
build:engflow --config=engflow_cache
build:engflow --define=EXECUTOR=remote
build:engflow --experimental_inmemory_dotd_files
build:engflow --experimental_inmemory_jdeps_files
build:engflow --nolegacy_important_outputs
build:engflow --grpc_keepalive_time=30s
build:engflow --host_platform=//platforms/linux_x86/config:platform
build:engflow --platforms=//platforms/linux_x86/config:platform
build:engflow --extra_toolchains=//platforms/linux_x86/config:cc-toolchain
build:engflow --extra_execution_platforms=//platforms/linux_x86/config:platform
build:engflow --crosstool_top=//platforms/linux_x86/cc:toolchain
build:engflow --host_crosstool_top=//platforms/linux_x86/cc:toolchain
build:engflow --cpu=k8
build:engflow --host_cpu=k8
build:engflow --compiler=clang
build:engflow --host_compiler=clang
build:engflow --remote_executor=grpcs://regolith.cluster.engflow.com
build:engflow --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
build:engflow --test_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=0
